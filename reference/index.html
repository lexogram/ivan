<!DOCTYPE html>
<html lang=en>
<head>
<meta charset="utf-8">
<title>Language Reference</title>
<link rel="stylesheet" href="../css/core.css" />
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
</head>

<body>
  <div class="sidebar">
    <div class="logo">
      <a href="../"><img src="../img/logo.png" alt="openbook home" /></a>
    </div>

    <nav>
      <ol>
        <li><a href="#top">Overview</a></li>
        <!-- <li><a href="#waiver">Waiver</a></li> -->
        <li><a href="#intro">Introduction</a></li>
        <li><a href="#iframe">Using an iframe</a></li>
        <li><a href="#helper">Using a helper tab</a></li>
        <li><a href="#next">Next (Placeholder)</a></li>
        <li><a href="#end">Conclusion</a></li>
      </ol>
    </nav>

    <p class="aside support">If you have any difficulty in this tutorial, please <a href="https://github.com/lexogram/openbook/issues/new">tell us about it</a>, and we will do our best to deal with it for you.</p>
  </div>

<main>
<header>
  <a href="https://github.com/lexogram/openbook/blob/master/LICENSE" class="cc">&#59409;</a>
  <h1>Connecting to third-party language reference sites</h1>
  <ul class="nav">
    <li>
      <a href="#back"><img src="../img/arrow.png" alt="back" /></a>
    </li><li>
      <a href="#next"><img src="../img/arrow.png" alt="next" /></a>
    </li>
  </ul>
</header>

<article class="un-inverted">
<!-- WAIVER -->
<!-- <section id="waiver">
  <div class="aside warn"><span class="h2">Waiver</span>
    <p>To weave its magic, the Annotations extension makes permanent records of your actions in a database on the server at lexogram.com.</p>
    <ul>
      <li>It records the IP address that is assigned to you at the moment when you start using the Annotations extension</li>
      <li>It records what pages you have visited, and on what dates</li>
      <li>It stores a copy of the text of each page you visit</li>
      <li>It stores the personal notes that you make, and, with your permission, may share these notes anonymously with other people</li>
    </ul>
     <p>From this information, the server generates a profile of your language skills which may become more and more accurate the more you use the Annotations extensions and the Lexogram service.</p>
     <p>You may register with Lexogram using a unique username and password, so that you can keep track of your learning on different computers and share the same computer with different learners. You may provide an email address or a cell phone number, in order to reset your password. If you do so, then it will be technically possible to connect the activity associated with your account to you personally. Even if you don't register, your IP address may provide enough information to identify you.</p>
     <p>Lexogram uses this data only to provide you with a service that we hope you will find valuable. Lexogram does not provide any information concerning your activities to any third parties. Lexogram does its best to keep its servers secure from malicious attacks. However, Lexogram cannot guarantee that your personal use of the Annotations extension and the Lexogram infrastructure will remain private forever. By using the Annotations extension, you agree to refrain from any activity that you might regret, and never to hold Lexogram responsible in any way for anything that happens as a result of your use of the services that Lexogram provides.</p>
  </div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#intro">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section> -->

<!-- INTRODUCTION -->
<section id="intro">
  <h2>Introduction to embedding data from third-party sites</h2>
  <p>There are several ways to obtain data from a server run by a third-party, such as Google, the Wikimedia Foundation: iframe, AJAX request and helper tabs. Each has its own strengths an limitations.</p>
  <h3>iframe</h3>
  <p>You can use an <code>&lt;iframe&gt;</code> tag to display certain third-party web pages inside your own web page.</p>
  <h4>Strengths</h4>
  <ul>
  <li>The entire interactive web page from the third-party site is embedded in your page.</li>
  </ul>
  <h4>Limitations</h4>
  <ul>
  <li>Certain pages, like <a href="https://translate.google.com">Google Translate</a> are designed for display only in their own tab; attempting to embed such a page in an <code>iframe</code> will fail.</li>
  <li>It's not possible to modify the CSS of a page displayed in an <code>iframe</code>. In particular, this means your page needs to adapt itself to the space requirements of the embedded page.</li>
  <li>You need to be aware of the potential <a href="https://developer.mozilla.org/en-US/Learn/HTML/Multimedia_and_embedding/Other_embedding_technologies#Security_concerns">security concerns</a> of allowing third-party pages to enter your own pages.</li>
  <li>You must be sure not to <a href="http://law.stackexchange.com/a/5137">infringe</a> on intellectual property or trademark issues.</li>
  </ul>

  <h3>AJAX request</h3>
  <p>If the third-party server allows it, you may be able to make an <a href="https://developer.mozilla.org/en-US/docs/AJAX/Getting_Started">AJAX</a> call to retrieve raw HTML from the server, which you can then insert into the native HTML of your page.</p>
  <h4>Strengths</h4>
  <ul>
  <li>You can manipulate the HTML as you see fit, cherry-picking the parts you want and inserting them where you want in your page.</li>
  <li>You can apply your own custom CSS to all the inserted HTML.</li>
  </ul>
  <h4>Limitations</h4>
  <ul>
  <li>When the user clicks on a link in the inserted HTML, your page may be replaced by a new page from the third-party server. You will need to intercept the clicks and convert them into custom AJAX calls.</li>
  <li>Certain AJAX APIs, such as the <a href="https://cloud.google.com/translate/docs/">Google Translate API</a> are provided as pay-per-use services. If your web site is still at the development stage, you may prefer a cost-free solution.</li>
  </ul>

  <h3>Helper tab</h3>
  <p>You can open the source web page in its own tab, and then use the <a href="https://developer.chrome.com/extensions/content_scripts">content script</a> of your Chrome extension to query the page for the information you need, and transfer it to your own web page.</p>
  <h4>Strengths</h4>
  <ul>
  <li>You can retrieve just the information you want to show in your page.</li>
  <li>You can format it in any way you want.</li>
  <li>The user can consult the helper tab at any time, to see all the information provided by the source server.</li>
  </ul>
  <h4>Limitations</h4>
  <ul>
  <li>The structure of the third-party page may change without notice, so the query selectors that you use to retrieve the desired information may break at any time.</li>
  </ul>

  <p class="aside next">The simplest technique is to embed a third-party web page inside your own, using an <code>&lt;iframe&gt;</code> tag. In the <a href="#iframe">next section</a>, you'll see how to do this with pages from <a href="https://www.wiktionary.org/">Wiktionary.org</a>.</p>

  <footer>
    <ul class="nav">
    <li>
    <a href="#iframe">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- IFRAME -->
<section id="iframe">
  <h2>Using an iframe to embed a third-party page</h2>

  <p class="aside warn">This tutorial follows on from a tutorial on creating the prototype <a href="../annotations">Annotations extension</a> for Chrome. If you haven't just completed that tutorial, the best way to get started here will be to <a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/15_colour.zip" target="source">download the source files</a> for the final section of that tutorial and work from there.</p>

  <div class="aside preview">In this section, you will learn how to :
    <ul>
      <li>Modify the Meteor web pages used for the NoteBook window, so you don't can deliver it from an Apache server.</li>
      <li>Create an <code>&lt;iframe&gt;</code> in your NoteBook page</li>
      <li>Set the <code>src</code> attribute of the <code>&lt;iframe&gt;</code> element when you select a word on a page in your browser.</li>
    </ul>
    <a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/16_wiktionary.zip" target="source">Download the source files</a>
  </div>

  <h3>Un-Meteorizing the NoteBook</h3>
  <p>Because this tutorial does not rely on any of the features of Meteor, you can simplify the files in your Meteor <code>client</code> folder as shown below:</p>

  <h4>Meteor <code>client/main.html</code></h4>
<pre>&lt;!DOCTYPE html&gt;
&lt;html lang=en&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;title&gt;NoteBook&lt;/title&gt;
  &lt;link rel="stylesheet" type="text/css" href="main.css"&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;p id="selection"&gt;&lt;/p&gt;
  &lt;iframe src="" id="wiktionary"&gt;&lt;/iframe&gt;
  &lt;script src="main.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;

<span class="delete">&lt;!-- &lt;head&gt;
  &lt;title&gt;NoteBook&lt;/title&gt;
&lt;/head&gt; --&gt;

&lt;!-- &lt;body&gt;
  &lt;p id="selection"&gt;&lt;/p&gt;
  
  &lt;table border="1"&gt;
    &lt;tr&gt;
      &lt;th&gt;Word&lt;/th&gt;
      &lt;th&gt;Index&lt;/th&gt;
      &lt;th&gt;Count/Billion&lt;/th&gt;
    &lt;/tr&gt;
      {{&gt; rows}}
  &lt;/table&gt;
&lt;/body&gt; --&gt;

&lt;!-- TEMPLATES --&gt;

&lt;!-- &lt;template name="rows"&gt;
  {{#each rows}}
    &lt;tr&gt;
      &lt;td&gt;{{word}}&lt;/td&gt;
      &lt;td&gt;{{index}}&lt;/td&gt;
      &lt;td&gt;{{count}}&lt;/td&gt;
    &lt;/tr&gt;
  {{/each}}
&lt;/template&gt; --&gt;</span></pre>

  <h4>Meteor <code>client/main.js</code></h4>
<pre><span class="delete">// import { Template } from 'meteor/templating'
// Template.rows.helpers({
//   rows: function rows() {
//     return Session.get("rows")
//   }
// })

// import { Session } from 'meteor/session'

// Session.set("rows", [])

// Meteor.startup(function() {</span>
  
<span class="new">;(function startUpWithoutMeteor(){</span>
  var  extensionId = "bjgdcgpomeengebjdjliaedpiboaildf"
  // Use your own extension id ^

  var connections = {
    port: null
  , p: document.getElementById("selection")
  <span class="new">, wiktionary: document.getElementById("wiktionary")
  , wikiURL: [
      "https://en.wiktionary.org/w/index.php?title="
    , "&printable=no"
    ]</span>

  , initialize: function initialize() {
      this.port = chrome.runtime.connect(extensionId)
      this.port.onMessage.addListener(treatMessage)

      return this
    }

  , changeSelection: function changeSelection(request) {
      var selection = request.data
      this.p.innerHTML = selection
      <span class="delete">// Meteor.call("analyzeText", {data: selection}, updateTable)</span>

      <span class="delete">// function updateTable(error, data) {</span>
      <span class="delete">//   if (error) {</span>

      <span class="delete">//   } else {</span>
      <span class="delete">//     Session.set("rows", data)</span>
      <span class="delete">//   }</span>
      <span class="delete">// }</span>
      
      <span class="new">this.showInWikiTab(selection)</span>
    }

  <span class="new">, showInWikiTab: function showInWikiTab(word) {
      var word = word.substr(0, word.indexOf(" ")) || word

      if (!word) {
        return
      }
      
      var url = this.wikiURL[0] + word + this.wikiURL[1]
      wiktionary.src = url
    }</span>

  , getFrequencyData: function getFrequencyData(request) {
      <span class="comment">// { method: "getFrequencyData"
      // , data: textContent
      // , id: &lt;tab id where call originated&gt; }</span>
      <span class="delete">// Meteor.call("getFrequencyData",request,treatFrequencyData)</span>

      function treatFrequencyData(error, data) {
        if (error) {
          console.log("treatFrequencyData", error)

        } else {
          connections.port.postMessage({ 
            method: "treatFrequencyData"
          , data: data
          , id: request.id
          })
        }
      }
    }

  , disableExtension: function disableExtension() {
      if (this.port) {
        this.port.postMessage({ method: "disableExtension" })
        this.port = null
      }
    }
  }.initialize()

  // LISTENERS //LISTENERS //LISTENERS //LISTENERS //LISTENERS //

  function treatMessage(request) {
    var method = connections[request.method]
    if (typeof method === "function") {
      method.call(connections, request)
    }
  }

  function disableExtension() {
    treatMessage({ method: "disableExtension" })
  }

  window.onbeforeunload = disableExtension
})()<span class="new">// remove iife () when Meteor.startup() is restored</span></pre>

  <p>You'll also have to make a small change the <code>background.js</code> script of your extension, to make the new version of the <code>client/main.html</code> file open without using Meteor as the server.</p>
  <h4><code>background.js</code></h4>
  <pre class="revised">"use strict"

;(function background(){

  var extension = {
    port: null
<span class="new">//, meteorURL: "http://localhost:3000/"
  , meteorURL: "http://localhost/NoteBook/main.html"
  // use your own local URL ^</span>
  , injectedHTML: chrome.extension.getURL("html/inject.html")
  , injectedCSSFile: "css/inject.css"
  , tabMap: {}

  <span class="omit">// code omitted for clarity</span>
})()</pre>

  <div class="aside note">This assumes that you know how to set up an Apache server on your development machine, and that you know how to edit the <code>hosts</code> and <code>httpd.conf</code> files to point the Apache server at the Meteor client folder. If that's not the case, then just don't comment out the lines of code in <span class="delete">red</span> above, and keep your Meteor server running.
  <p>The advantage of using Apache instead of Meteor is that you can more easily host your files online, and get your friends and colleagues to test your extension without running their own Meteor servers.</p></div>

  <h3>Adding CSS for the <code>iframe</code></h3>
  <p>By default, the dimensions of the <code>iframe</code> will be set to something like 300 x 150 pixels, which is not nearly big enough to show the contents of the Wiktionary page. You can fix this by adding the following rule to your <code>main.css</code> file:</p>
  <h4>Meteor <code>mais.css</code></h4>
  <pre class="revised">p#selection {
  min-height: 2em;
  width: 100%;
  background-color: #ddd;
  border: 1px solid #ccc;
  border-bottom-color: #eee;
  border-right-color: #eee;
}

table {
  border: 1px solid #000;
  border-collapse: collapse;
  min-width: 200px;
  width: 100%;
}
th {
  background-color: #ccc;
  padding: 0.1em 0.25em;
}
td {
  padding: 0 0.25em;
}
td {
  text-align: right;
}
td:first-child {
  text-align: left;
}

<span class="new">iframe#wiktionary {
  width: 888px;
  height: 555px;
}</span></pre>

  <h3>Setting the <code>src</code> for the <code>iframe</code></h3>
  <p>The edited <code>main.html</code> file now includes an <code> &lt;iframe&gt;</code> tag with an id of <code>#wiktionary</code>. The <code>changeSelection</code> method in the <code>main.js</code> script now calls a <code>showInWikiTab</code> method, which creates a URL of the form ...</p>
  <pre>"https://en.wiktionary.org/w/index.php?title=" +
<span class="ymmv">WORD_TO_LOOK_UP</span>
+ "&amp;printable=no"</pre>
  <p>... which it uses to set the <code>src</code> of the <code>iframe</code>.</p>
  <p>Now, when you make a selection in the main content window, the Wiktionary page for the first word in the selection (or for the lowercase version of that word) will be shown in the NoteBook window. You may have to resize the window to see enough of the page.</p>

  <figure>
  <img src="img/wiktionary.png" alt="The Wiktionary page appears in the iframe" />
  <figcaption>Figure 1. The Wiktionary page appears in the <code>iframe</code></figcaption>
  </figure>

  <div class="aside next">In this section, you've:
    <ul>
      <li>Simplified the files in the Meteor <code>client</code> folder, so that you have a NoteBook page which is easy to run from a remote web server</li>
      <li>Modified the <code>client/main.js</code> script so that your NoteBook displays the appropriate page from the English version of Wiktionary for the first selected word.</li>
    </ul> 
    <p>However, there are a number of issues with this.</p>
    <ul>
      <li>Most people learning a foreign language will not have English as their native language, so you need to provide the possibility of choosing which language Wiktionary is displayed in.</li>
      <li>The Wiktionary page includes a wide sidebar on the left, and a toolbar at the top, which many users will not need to see.</li>
      <li>The page may include data about languages that the user is not currently learning.</li>
    </ul>
    <p>In later sections, we'll deal with each of these issues, but in the <a href="#helper">next section</a>, you'll see a different way to get data from a third-party site, using a helper tab.</p>
  </div>

  <footer>
    <ul class="nav">
      <li>
        <a href="#helper">
          <img src="../img/arrow.png" alt="next"/>
        </a>
      </li>
    </ul>
  </footer>
</section>

<!-- HELPER TAB -->
<section id="helper">
  <h2>Using a helper tab to display a translation from Google</h2>
  <div class="aside preview">In this section, you will see how to :
    <ul>
      <li></li>
    </ul>

    <a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/17_helper.zip" target="source">Download the source files</a>
  </div>

  <div class="aside preview">In this section, you'll learn how to:
    <ul>
      <li>X</li>
      <li>Y</li>
    </ul>
  </div>

  <div class="aside next">In this section, you've 
    <p>In the <a href="#end">next section</a>, you'll .</p>
  </div>

  <footer>
    <ul class="nav">
      <li>
        <a href="#end">
          <img src="../img/arrow.png" alt="next"/>
        </a>
      </li>
    </ul>
  </footer>
</section>

<!-- NEXT -->
<section id="next">
  <h2>NEXT</h2>
  <div class="aside preview">In this section, you will see how to :
    <ul>
      <li></li>
    </ul>

    <a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/next.zip" target="source">Download the source files</a>
  </div>

  <div class="aside preview">In this section, you'll learn how to:
    <ul>
      <li>X</li>
      <li>Y</li>
    </ul>
  </div>

  <div class="aside next">In this section, you've 
    <p>In the <a href="#end">next section</a>, you'll .</p>
  </div>

  <footer>
    <ul class="nav">
      <li>
        <a href="#end">
          <img src="../img/arrow.png" alt="next"/>
        </a>
      </li>
    </ul>
  </footer>
</section>

<!-- CONCLUSION -->
<section id="end">
<h2>Conclusion</h2>
<div class="aside preview">Here's what you've learnt:
<ul>
<li>98% of good stuff</li>
<li>2% salt</li>
</ul>
</div>

<p>Well done!</p>
</section>

<!-- OVERVIEW : SECTION 0 -->
<section id="top">
  <h2>Overview</h2>
  <p class="top">Lexogram is an online language-learning environment consisting of a Chrome extension and a <a href="../notebook/">reactive web site</a> built with  <a href="https://www.meteor.com/">Meteor</a>. Lexogram helps you make notes about web pages that you visit in the language that you are learning.</p>
  <p>This tutorial shows you how to create a web page that can display information from third-party language reference sites, such as <a href="translate.google.com">Google Translate</a> and <a href="https://www.wiktionary.org/">Wiktionary</a>. It follows on from an <a href="../annotations/">earlier tutorial</a> which shows you how to create a Chrome extension and communicate with a Meteor site running on your local server. For simplicity, the Meteor-specific elements have been commented out for this tutorial. This means that the web page you create can be hosted on any HTML server.</p>

  <div class="aside preview">In particular, you will be learning to:
    <ul>
      <li>Query Wiktionary for information on a word in any language</li>
      <li>Query Google Translate for a machine translation of a multi-word phrase</li>
    </ul>
  </div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#intro">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>
</article>
</main>

<script src="../js/core.js"></script>
</body>
</html>
