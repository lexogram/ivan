<!DOCTYPE html>
<html lang=en>
<head>
<meta charset="utf-8">
<title>Chrome extension</title>
<link rel="stylesheet" href="../css/core.css" />
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
</head>

<body>
  <div class="sidebar">
    <div class="logo">
      <a href="../"><img src="../img/logo.png" alt="openbook home" /></a>
    </div>

    <nav>
      <ol>
        <li><a href="#top">Overview</a></li>
        <li><a href="#waiver">Waiver</a></li>
        <li><a href="#intro">Introduction</a></li>
        <li><a href="#basic">A basic extension</a></li>
        <li><a href="#window">A standalone window</a></li>
        <li><a href="#meteor">Creating a Meteor site</a></li>
        <li><a href="#actions">Detecting user actions</a></li>
        <li><a href="#toolbar">Inserting a toolbar</a></li>
        <li><a href="#messages">Sending messages</a></li>
        <li><a href="#server">Server-side with Meteor</a></li>
        <li><a href="#tbd">TBD</a></li>
        <li><a href="#end">Conclusion</a></li>
      </ol>
    </nav>
  </div>

<main>
<header>
  <a href="https://github.com/lexogram/openbook/blob/master/LICENSE" class="cc">&#59409;</a>
  <h1>Annotations : a Chrome extension</h1>
  <ul class="nav">
    <li>
      <a href="#back"><img src="../img/arrow.png" alt="back" /></a>
    </li><li>
      <a href="#next"><img src="../img/arrow.png" alt="next" /></a>
    </li>
  </ul>
</header>

<article>
<!-- WAIVER -->
<section id="waiver">
  <div class="aside warn"><span class="h2">Waiver</span>
    <p>To weave its magic, the Annotations extension makes permanent records of your actions in a database on the server at lexogram.com.</p>
    <ul>
      <li>It records the IP address that is assigned to you at the moment when you start using the Annotations extension</li>
      <li>It records what pages you have visited, and on what dates</li>
      <li>It stores a copy of the text of each page you visit</li>
      <li>It stores the personal notes that you make, and, with your permission, may share these notes anonymously with other people</li>
    </ul>
     <p>From this information, the server generates a profile of your language skills which may become more and more accurate the more you use the Annotations extensions and the Lexogram service.</p>
     <p>You may register with Lexogram using a unique username and password, so that you can keep track of your learning on different computers and share the same computer with different learners. You may provide an email address or a cell phone number, in order to reset your password. If you do so, then it will be technically possible to connect the activity associated with your account to you personally. Even if you don't register, your IP address may provide enough information to identify you.</p>
     <p>Lexogram uses this data only to provide you with a service that we hope you will find valuable. Lexogram does not provide any information concerning your activities to any third parties. Lexogram does its best to keep its servers secure from malicious attacks. However, Lexogram cannot guarantee that your personal use of the Annotations extension and the Lexogram infrastructure will remain private forever. By using the Annotations extension, you agree to refrain from any activity that you might regret, and never to hold Lexogram responsible in any way for anything that happens as a result of your use of the services that Lexogram provides.</p>
  </div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#intro">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- INTRODUCTION -->
<section id="intro">
  <h2>Introduction to Chrome extensions</h2>
  <p>A Chrome extension can consist of several moving parts:</p>
  <ul>
  <li>A clickable icon that appears in the Chrome toolbar to the right of the address bar omnibox</li>
  <li>An HTML page that can open either as a popup or as a separate window</li>
  <li>"Background" code that is loaded and run as soon as Chrome is launched. This defines what happens when you click on the toolbar icon</li>
  <li>"Content" code that is injected into every page while the extension is enabled, and run after the page has loaded</li>
  <li>CSS that is injected into every page while the extension is enabled.</li>
  </ul>
  <p class="aside info">The injected data (code and CSS) is not applied to the extension's custom HTML page.</p>
  <p>The Chrome browser provides a number of proprietary methods to call methods in the <code>background</code> code or in another window or tab. This means that you can inject code into the pages that your user will visit, and use that to communicate between tabs and windows, via the <code>background</code> code.</p>
  <p>You can arrange for an HTML page to open when you click the extension icon. You can also use the injected <code>content</code> code to modify the DOM and the CSS of the main page.</p>
   <div class="aside preview">In this tutorial, you will see how to use these techniques to:
   <ul>
  <li>Add a toolbar at the top of the main page</li>
  <li>Replace the <code>body</code> of the page with a modified copy, so that you can change the colour of individual words</li>
  <li>Display a reactive <a href="https://www.meteor.com/" class="plain">Meteor</a> web site in the custom window</li>
  <li>Tell your Meteor server about the user's actions in a third-party web page</li>
  <li>Use information that you retrieve from your server to update the Notebook window and to customize the appearance of the third-party page</li>
  </ul>
  </div>
  <p class="aside note">For this tutorial, the Meteor website that you will be working with will be a simple proof-of-concept prototype, with just enough features to show how the Chrome extension messaging system works. A <a href="../notebook/">forthcoming tutorial</a> will deal with the more advanced features of the Meteor site.</p>

  <footer>
    <ul class="nav">
    <li>
    <a href="#basic">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- BASIC EXTENSION -->
<section id="basic">
<h2>Creating a basic extension</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to create a manifest.json file to define your extension</li>
<li>How to create a button for the Chrome Toolbar</li>
<li>How to create a page to display when the button is pressed</li>
<li>How to activate your extension</li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/01_basic_extension.zip" target="source">Download the source files</a>
</div>

<p>To create the simplest possible extension, you will need to create three files:</p>
<dl>
  <dt>manifest.json</dt>
  <dd>This file tells Chrome about your extension and how to find the other two files. It must be called "manifest.json". The other files can have any name you want, so long as their names are recorded inside the <code>manifest.json</code> file.</dd>
  <dt>A 19 x 19 pixel image</dt>
  <dd>This will be used to create a button in the Chrome toolbar. In the <code>manifest.json</code> file shown below, it is named <code>icon.png</code>.</dd>
  <dt>A simple HTML file</dt>
  <dd>This contents of this file will be displayed in a window when you click on the Chrome toolbar icon. In the <code>manifest.json</code> file shown below, it is named <code>popup.html</code>.</dd>
</dl>
<h3>manifest.json</h3>
<p>The <code>manifest.json</code> file is in <a href="http://www.json.org/">JSON</a> format. It can contain a wide range of information. The essential details are shown below.</p>
<pre>{
  "manifest_version": 2

, "name": "Annotations"
, "version": "alpha"
, "description": "Helps you save and share notes about web pages"

, "browser_action": {
    "default_icon": "icon.png"
  , "default_popup": "popup.html"
  }

, "permissions": [
    "activeTab"
  ]
}</pre>
<div class="aside note">Notes on the essential fields used in manifest.json
  <ul>
  <li><code>manifest_version</code> must be <code>2</code> in order to ensure that all the features mentioned in this tutorial are available.</li>
  <li>In the Chrome Extensions management page, <code>name</code> will be used as the name of the extension. It may also be used as the tooltip when you roll your mouse over the extension's icon. The name does not have to be unique. It should be 45 characters or less.</li>
  <li>The <code>version</code> must be a string of between 1-4 dot-separated integers each between 0 and 65536, such as "1" or "4.32.1.0"</li>
  <li>The <code>description</code> is optional. It should be a plain text string (no HTML or other formatting) of 132 characters or less. The description will be used both in the Chrome extension page and in the Chrome Web Store.</li>
  <li>There are two types of extension: <a href="https://developer.chrome.com/extensions/browserAction">browser_action</a>  extensions that can be used with any page, and <a href="https://developer.chrome.com/extensions/pageAction">page_action</a> extensions that will only be activated if the current page fits a particular set of criteria. The Annotations extension is designed for use with any page, so this <code>manifest.json</code> file contains an entry for <code>browser_action</code>.</li>
  <li>If no <code>default_icon</code> is provided, then the button in the Chrome toolbar will use the first letter of the <code>name</code> to create an image for the button. You can use in image of any size, but it will be redimensioned to 19 x 19 pixels, so it's best to create an image at that size.</li>
  <li>The simplest action for an extension is to display a popup window when the toolbar button is clicked. To see this in action, for now, you can create a simple HTML page. However, the Annotations extension will not use a popup window, so the <code>default_popup</code> entry will be removed later.</li>
  <li>Users must grant an extension <code>permissions</code> to access any personal information. The lowest level of permission is access to the data on the current page or <code><a href="https://developer.chrome.com/extensions/activeTab">activeTab</a></code>. You'll need to add other permissions later.</li>
  </ul>
</div>

<figure>
<img src="img/tooltip.png" alt="extension tooltip" />
<figcaption>Figure 3. The <code>name</code> appears as a tooltip on rollover</figcaption>
</figure>

<h3>The default_popup file</h3>
<p>For the Annotations extension, you will be opening a new window rather than using a popup, but to get started, you can create a file named <code>popup.html</code> with the following minimal content:</p>
<pre>&lt;!DOCTYPE html&gt;
&lt;body&gt;
&lt;h1&gt;Popup&lt;/h1&gt;
&lt;p&gt;More stuff can go here&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>

<h3>Loading your extension</h3>
<p>Place your <code>manifest.json</code>, <code>popup.html</code> and <code>icon.png</code> files in the same folder on your hard drive (or <a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/01_basic_extension.zip" target="source">download the source files</a> and decompress them). Open Chrome and type <code>chrome://extensions</code> in the address omnibox, then press the Enter key.</p>
<figure>
<img src="img/load.png" alt="loading your extension" />
<figcaption>Figure 4. Loading your extension</figcaption>
</figure>
<p>Make sure the Developer Mode checkbox is selected, and then click on the Load Unpacked Extension button. A dialogue window will open; you can select the folder in which you saved your three files. The icon that you chose will appear in a button to the right of the address omnibox. If you click on it, a popup window will open to display your HTML page.</p>

<figure>
<img src="img/basic.png" alt="popup window" />
<figcaption>Figure 5. The <code>default_popup</code> appears when you click on the icon</figcaption>
</figure>

<div class="aside next">In this section, you've created a minimalist Chrome extension that opens a popup window. You seen the importance of the <code>manifest.json</code> file and how to tell Chrome that your extension exists.
<p>In the <a href="#window">next section</a>, you'll see how to create a background script to open a stand-alone window.</p>
</div>
<div class="optional tips">
<input type="checkbox" id="icon-tips"/>
<label for="icon-tips">Tip: Additional Icons</label>
<div>
<p>Currently, a generic icon is used for your extension in the Chrome Extensions management page.</p>
<figure>
<img src="img/default_icon.png" alt="default icon" />
<figcaption>Figure 6. The default Chrome extension icon</figcaption>
</figure>
<p>It's a good idea to create additional icons that will be used on the Extensions management page, in the Chrome Web Store, during the installation of your extension, and as the favicon of any browser pages your extension might create.</p>
<p>You can <a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/01a_additional_icons.zip" target="source">download the source files</a> for a slightly more complex extension which places all the icon files in the same <code>img</code> folder, and gives them names that indicate their sizes.</p>
<pre class="revised">{
  "manifest_version": 2

, "name": "Annotations"
, "version": "1.0"
, "description": "Helps you save and share notes about web pages."

, "browser_action": {
    "default_icon": "<span class="new">img/</span>icon<span class="new">19</span>.png"
  , "default_popup": "popup.html"
  }

, "permissions": [
    "activeTab"
  ]

<span class="new">, "icons": {
    "16": "img/icon16.png"
  , "48": "img/icon48.png"
  , "128": "img/icon128.png"
  }</span>
}</pre>
<p>If you use this version of the extension, you'll see a custom icon for your extension in the Extensions management page.</p>
<figure>
<img src="img/custom_icons.png" alt="custom icons" />
<figcaption>Figure 7. A custom icon for your extension</figcaption>
</figure>
<p>You can find more information about this on the <a href="https://developer.chrome.com/apps/manifest/icons">Chrome Developer site</a>.</p>
</div>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#window">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- WINDOW -->
<section id="window">
<h2>A standalone window</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to create a background script that will be loaded as soon as Chrome is launched</li>
<li>How to call a method in the background script when the extensions toolbar button is clicked</li>
<li>How to tell Chrome to open a new window to display a specific URL</li>
<li>How to debug a background script</li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/02_standalone_window.zip" target="source">Download the source files</a>
</div>

<h3>Declaring a background script</h3>
<p>In your <code>manifest.json</code> file, you can declare a <code>background</code> page. Chrome will create the page when it first starts up (or when you reload your extension) but will never show it. You can use the background page to load scripts that will be available at all times the browser is open. Here's how you can modify your <code>manifest.json</code> file so that it loads a script called <code>background.js</code>:</p>

<pre class="revised">{
  "manifest_version": 2

, "name": "Annotations"
, "version": "1.0"
, "description": "Helps you save and share notes about web pages."

, "browser_action": {
    "default_icon": "img/icon19.png"
  }

, "permissions": [
    "activeTab"
  ]

, "icons": {
    "16": "img/icon16.png"
  , "48": "img/icon48.png"
  , "128": "img/icon128.png"
  }

<span class="new">, "background": {
    "scripts": [
      "js/background.js"
    ]</span>
  }
}</pre>

<h3>background.js</h3>
<p>You can create a file called <code>background.js</code> with the following script. Notice that it refers to another file called <code>popup.html</code>; you can use the existing file with that name for now.</p>
<p>Notice that the script uses a custom <code>notify()</code> method to both show an alert and log data in the console. You'll see shortly how to bring up the console where you can see the logged data. You'll also notice that this script makes calls to methods that are defined on a global <code>chrome</code> object.</p>

<pre>"use strict"

;(function background(){

  function notify() {
    console.log.apply(console, arguments)
    alert(arguments[0])
  }

  function useExtension() {
    notify ("useExtension triggered")

    var URL = <span class="red">chrome.extension.getURL</span>("html/popup.html")
    var width = 300
    var top = 0

    var options = {
      url: URL
    , left: screen.availWidth - width
    , top: top
    , width: width
    , height: screen.availHeight - top
    , focused: false
    , type: "popup" // "normal"
    }

    <span class="red">chrome.windows.create</span>(options, callback)

    function callback(window_data) {
      notify ("window opened", window_data)
    }
  }

  <span class="red">chrome.browserAction.onClicked.addListener</span>(useExtension)
  notify ("Background script loaded")
})()</pre>

<h3>Reloading your extension</h3>
<p>Here's how your files should be organized now, so that the <code>manifest.json</code> file can find them all:</p>
<figure>
<img src="img/background_js.png" alt="file hierarchy" />
<figcaption>Figure 8. The new arrangement of your extension files</figcaption>
</figure>

<p>Each time you make a change to your extension, you need to tell Chrome to reload it. You can do this by clicking on the Reload link for your extension in the Chrome Extensions management window.</p>

<figure>
<img src="img/reload.png" alt="Reload your extension and open the Inspector window for the background page" />
<figcaption>Figure 9. Reload your extension and open the Inspector window for the background page</figcaption>
</figure>

<h3>Debugging a background script</h3>
<p>As you can see in Figure 9, abovo, when you reload your extension after adding a background script, you will see a new Inspect Views link in the Extension management panel, which allows you to open a Developer Tools Inspector window for the <code>background</code> page which Chrome has now created. When you activate your extension, your <code>popup.html</code> page should open in a new window. You'll see that the output of the <code>console.log()</code> command appears in the Console in the Inspector window for your <code>background</code> page.</p>

<h3>The <code>chrome</code> object</h3>
<p>It's time now to look closer at what your <code>background.js</code> script is doing, and especially at the following three lines:</p>

<pre><span class="red">chrome.extension.getURL</span>("html/popup.html")

<span class="red">chrome.windows.create</span>(options, callback)

<span class="red">chrome.browserAction.onClicked.addListener</span>(useExtension)</pre>

All scripts running in Chrome have access to a  object named <code>chrome</code>. However, scripts running in a standard window and script running in the <code>background</code> have access to different objects that have the same name.
<figure>
<img src="img/page_chrome.png" alt="page chrome object" />
<figcaption>Figure 10. The <code>chrome</code> object available in standard windows</figcaption>
</figure> 

<figure>
<img src="img/background_chrome.png" alt="background chrome object" />
<figcaption>Figure 11. The <code>chrome</code> object available to background scripts</figcaption>
</figure>
<p>As you can see from Figure 11, the <code>chrome</code> object that is available to <code>background</code> scripts posseses a number of extension-specific properties:</p>
<ul>
<li><code><a href="https://developer.chrome.com/extensions/browserAction">browserAction</a></code> </li>
<li><code><a href="https://developer.chrome.com/extensions/extension">extension</a></code> </li>
<li><code><a href="https://developer.chrome.com/extensions/i18n">i18n</a></code> (internationalization)</li>
<li><code><a href="https://developer.chrome.com/extensions/management">management</a></code> </li>
<li><code><a href="https://developer.chrome.com/extensions/permissions">permissions</a></code> </li>
<li><code><a href="https://developer.chrome.com/extensions/tabs">tabs</a></code> </li>
<li><code><a href="https://developer.chrome.com/extensions/windows">windows</a></code> </li>
</ul>
<p>You will be using several of these to as you develop your extension.</p>
<h4><code>chrome.extension</code></h4>
<p>The <code>chrome.extension</code> API provides support for exchanging messages between extensions or between an extension and its content scripts that have been injected into the pages in a standard window.</p>
<p>The <code><a href="https://developer.chrome.com/extensions/extension#method-getURL">chrome.extension.getURL()</a></code> method converts a relative path such as <code>"html/popup.html"</code> into a fully-qualified URL: <code>"chrome-extension://maabmcngoiolpokniappbcolnflbgopo/html/popup.html"</code> </p>
<h4><code>chrome.windows</code></h4>
<p>You can use the <code>chrome.windows</code> API to create, modify, and rearrange windows in the browser.</p>
<p>The <code><a href="https://developer.chrome.com/extensions/windows#method-create">chrome.windows.create(options, callback)</a></code> opens a new browser window with any optional sizing, position or default URL that you provide in the <code>options</code> argument.</p>
<h4>chrome.browserAction</h4>
<p>The <code>chrome.browserAction</code> allows you to control the extension button in the Chrome toolbar. You can modify its appearance, its title, and whether it is enabled. You can also detect when it is clicked, using the <code>chrome.browserAction.onClicked</code> event. The code above sets a listener for this event, and uses that to open a custom window with a specified position and size.</p>
<p class="aside note">The listener for the <code>chrome.browserAction.onClicked</code> event will be triggered every time the toolbar button is clicked, not just the first time. Later you will be modifying this code so that it reacts differently if the extensions custom window is already open.</p>
<h4>Window <code>type</code></h4>
<p>The <code><a href="https://developer.chrome.com/extensions/windows#type-CreateType">type</a></code> of the window is set to <code>"popup"</code>. This creates a window with no toolbar, so the user cannot navigate to another page in this window. There are four possible values for <code>type</code>:</p>
<ul>
<li><code>"normal"</code> (default)</li>
<li><code>"popup"</code></li>
<li><code>"panel"</code></li>
<li><code>"detached_panel"</code></li>
</ul>
<p>At the time of writing, <code>"popup"</code>, <code>"panel"</code> and <code>"detached_panel"</code> all have the same effect.</p>
<figure>
<img src="img/normal_window.png" alt='A window with a type of "normal"' />
<figcaption>Figure 12. A window with a <code>type</code> of "normal"</figcaption>
</figure>
<figure>
<img src="img/popup_window.png" alt='A window with a <code>type</code> of "popup"' />
<figcaption>Figure 13. A window with a <code>type</code> of "popup"</figcaption>
</figure>

<h3>The <code>Window</code> object</h3>
<p>When <code>chrome.windows.create(options, callback)</code> is run, it activates an optional callback, and sends a <code>Window</code> object as the argument:</p>
<pre>{ alwaysOnTop: false
, focused: false
, height: 777
, id: 161
, incognito: false
, left: 880
, state: "normal"
, tabs: [
    active: true
  , audible: false
  , height: 682
  , highlighted: true
  , <span class="red">id: 162</span>
  , incognito: false
  , index: 0
  , mutedInfo: Object
  , pinned: false
  , selected: true
  , status: "loading"
  , width: 400
  , windowId: 161
  ]
, top: 23
, type: "normal"
, width: 400
}</pre>
<p>In <a href="">TODO</a>, you'll use the <code>id</code> of the only tab of this window as a filter. You want this custom window to update when you interact with other windows, but you want to prevent this window from reacting to itself.</p>
<div class="aside next">In this section, you've set up a a background script to react to a click on the toolbar button for your extension, and you've used that action to open a custom window. You've also seen how to open a Developer Tools Inspector window, so that you can debug your background script.
<p>In the <a href="#meteor">next section</a>, you'll see how to install and run a Meteor web server on your development computer, and you'll get your custom popup window to display the site running on your Meteor server.</p>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#toolbar">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- METEOR -->
<section id="meteor">
<h2>Creating a Meteor site</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to install Meteor on your development computer</li>
<li>How to view the default Meteor app in your extension popup window</li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/03_meteor.zip" target="source">Download the source files</a>
<a href="https://www.meteor.com/install">Install Meteor</a>
</div>

<p><a href="https://www.meteor.com/">Meteor</a> is an open-source platform for creating reactive web sites in pure JavaScript. It runs on Windows, OSX and Linux and it allows you to write code that runs on the server or in the browser in one place and in one language. To deliver a very basic web page using Meteor takes a little time, but virtually no effort.

<h3>Installing Meteor</h3>
<p>It's easy to install Meteor on your development machine. First make sure that you are connected to the Internet.</p>

<h4>Windows</h4><p>If you are on Windows, simply <a href="https://install.meteor.com/windows">download the installer</a> and run it.</p>
<h4>OSX and Linux</h4>
<p>If you are on OSX or Linux, you can install Meteor from a <a href="../html/terminal.html">Terminal window</a>. You need to use the Terminal as an administrator.
<div class="aside tip">If you are working from a non-admin account, you'll need to start by logging in as an admin:
<pre class="revised"><span class="new">su <em>admin</em></span>
Password:•</pre>
<p>Use the name of an administrator for your computer rather than <em>admin</em>, then type your password.</p></div>
<p>In a Terminal window, type ...</p>
<pre>curl https://install.meteor.com/ | sh</pre>
<p>... and wait while the latest version of Meteor is automatically installed. The Terminal window will fill up with something like this:</p>
<pre class="revised">  %  Total  % Received  % Xferd  Average Speed    Time     Time
                                 Dload  Upload    Total    Spent
100   7592  0     7592  0     0   5873       0  --:--:--  0:00:01 
Removing your existing Meteor installation.
Downloading Meteor distribution
########################################################## 100.0%
Meteor 1.3.4 has been installed in your home directory (~/.meteor)
Writing a launcher script to /usr/local/bin/meteor for your
convenience.
This may prompt for your password.
Password:•
</pre>
<p>Enter your admin password when you see the prompt for it, to complete the installation. If you did not run the <code>curl</code> command as an administrator, this step may fail.</p>

<h3>Creating the default Meteor web site</h3>
<p>In the Terminal window, use the <code><a href="http://www.computerhope.com/unix/ucd.htm">cd</a></code> command to navigate to the directory where you want to create your Meteor web site, and enter the following commands:</p>
<pre>meteor create NoteBook
cd NoteBook
meteor</pre>
<p>The first command may take a few minutes, as Meteor performs all the actions necessary for populating the <code>notebook</code> folder. When all is done, your folder should contain five items, including two that may be invisible: <code>.gitignore</code> and <code>.meteor</code>.</p>
<figure>
<img src="img/meteor_folder.png" alt="Contents of the notebook folder" />
<figcaption>Figure 14. Contents of the NoteBook folder</figcaption>
</figure>

<p>When you run the final <code>meteor</code> command, you'll see a series of actions logged to the Terminal window, as the Meteor application launches. Finally, you should see something like this:</p>

<pre>
[[[[[ <em>/Path/to/the/folder/NoteBook</em> ]]]]]

=> Started proxy.                             
=> Started MongoDB.
=> Started your app.                          

=> App running at: http://localhost:3000/
</pre>
<p class="aside note">When you want to stop the Meteor app, press <code>Ctrl-C</code></p>
<p class="aside note"><a href="https://www.mongodb.com/">MongoDB</a> is a free open-source cross-platform document-oriented database. It stores data in a JSON-like format, similar to the format of the <code>manifest.json</code> document you created earlier. (TODO: add reference to Neo4j?)</p>

<h3>Displaying the Meteor web page in the popup window</h3>
<p>You can test that the Meteor server is running by visiting <a href="http://localhost:3000/">http://localhost:3000/</a> in your browser. To get the Meteor page to show in your extensions popup window, you need to make some changes to your <code>background.js</code> script, as shown below.</p>
<pre class="revised">"use strict"

;(function background(){

  <span class="new">var windowOpen = false</span>

  function useExtension() {
    <span class="new">if (windowOpen) {
      return
    }</span>

    var URL = <span class="new">"http://localhost:3000/"</span>
    var width = 300
    var top = 0

    var options = {
      url: URL
    , left: screen.availWidth - width
    , top: top
    , width: width
    , height: screen.availHeight - top
    , focused: false
    , type: "popup"
    }

    chrome.windows.create(options, callback)

    function callback(window_data) {
      <span class="new">windowOpen = true</span>
    }
  }

  chrome.browserAction.onClicked.addListener(useExtension)
})()</pre>
<p>The most important change is setting the <code>URL</code> to <code>"http://localhost:3000/"</code> so the window shows your Meteor site. The other changes ensure that the window is only opened once, the first time you click on the toolbar button.</p>
<p class="aside note">Right now, if you close the popup window, then it will stay closed until you relaunch Google or reload your extension. In <a href="#">TODO</a>, you will be adding code that resets <code>windowOpen</code> to false when the window is closed.</p>
<p>When you reload your extension and click on the toolbar button, you should see something like this:</p>
<figure>
<img src="img/meteor_default.png" alt="The default Meteor page in your extensions popup window" />
<figcaption>Figure 15. The default Meteor page in your extensions popup window</figcaption>
</figure>

<p>The default Meteor site doesn't do anything that you want it to do yet.</p>

<div class="aside next">In this section, you've seen how simple it is to install Meteor and to launch a default web site. You've also seen how to get the popup window of your extension to display this Meteor web site.
<p>Now that your extension can connect to your own server in the custom window, it's time to look at how to set up communications between pages displayed in the main window and your custom page.</p>
<p>In the <a href="#actions">next section</a>, you'll see how to inject code into pages in the main window, and use them to detect user actions.</p>
</div>

<p class="aside support">If you have any difficulty anywhere in this tutorial, please <a href="https://github.com/lexogram/openbook/issues/new">tell us about it</a>, and we'll do our best to deal with it for you. Your questions and suggestions can help us make this tutorial better.

  <footer>
    <ul class="nav">
    <li>
    <a href="#actions">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- ACTIONS -->
<section id="actions">
<h2>Detecting user actions in the main window</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to </li>
<li>How to </li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/03_meteor.zip" target="source">Download the source files</a>
</div>

<div class="aside next">In this section, you've .
<p>In the <a href="#messages">next section</a>, you'll .</p>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#messages">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- MESSAGES -->
<section id="messages">
<h2>Sending messages between tabs</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to </li>
<li>How to </li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/03_meteor.zip" target="source">Download the source files</a>
</div>

<div class="aside next">In this section, you've .
<p>In the <a href="#toolbar">next section</a>, you'll .</p>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#toolbar">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- TOOLBAR -->
<section id="toolbar">
<h2>Inserting a toolbar into the current tab</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to </li>
<li>How to </li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/04_toolbar.zip" target="source">Download the source files</a>
</div>

<div class="aside next">In this section, you've .
<p>In the <a href="#server">next section</a>, you'll .</p>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#server">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- SERVER -->
<section id="server">
<h2>Server-side scripts with Meteor</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to </li>
<li>How to </li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/03_meteor.zip" target="source">Download the source files</a>
</div>

<div class="aside next">In this section, you've .
<p>In the <a href="#tbd">next section</a>, you'll .</p>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#tbd">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- TBD -->
<section id="tbd">
<h2>TBD</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to </li>
<li>How to </li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/03_meteor.zip" target="source">Download the source files</a>
</div>

<div class="aside next">In this section, you've .
<p>In the <a href="#end">next section</a>, you'll .</p>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#end">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- CONCLUSION -->
<section id="end">
<h2>Conclusion</h2>
<div class="aside preview">Here's what you've learnt:
<ul>
<li>How to create a Chrome extension</li>
<li>How to modify the DOM of the main page</li>
<li>How to communicate between different pages</li>
<li>How to interact with your own server</li>
</ul>
</div>

<p>Well done! Now you're ready to add features to your Meteor server, to make the service provided by the extension even more valuable. Time for a <a href="../notebook/">new tutorial</a>.</p>
</section>

<!-- OVERVIEW -->
<section id="top">
  <h2>Overview</h2>
  <p class="top">Lexogram's <a href="#">Annotations</a> is a Chrome extension which helps you learn a language by making notes about web pages that you visit in the language that you are learning. This tutorial takes you step-by-step through the process of building version 1.0 of the Annotations extension.</p>
  <p>When you launch the Annotations extension, a popup window will open to display the Lexogram Notebook web site. The extension sets up communications between the page you have open in the main window and the Notebook, and provides a series of tools that help you understand and remember what you are reading.</p>

  <div class="aside preview">In particular, the Annotations extension:
    <ul>
      <li>Tells the Notebook window what text you have selected on the main page</li>
      <li>Allows you to make your own notes and translations, and saves them to the Lexogram server so that they can be shared with others</li>
      <li>Remembers which words and expressions you have become familiar with, and highlights those that it thinks will be new to you.</li>
    </ul>
  </div>

  <figure>
  <img src="img/overview.png" alt="The Annotations extension in action" />
  <figcaption>Figure 1. The Annotations extension in action</figcaption>
  </figure>

  <p class="aside support">If you have any difficulty anywhere in this tutorial, please <a href="https://github.com/lexogram/openbook/issues/new">tell us about it</a>, and we'll do our best to deal with it for you. Your questions and suggestions can help us make this tutorial better.

  <footer>
    <ul class="nav">
    <li>
    <a href="#waiver">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>
</article>
</main>

<script src="../js/core.js"></script>
</body>
</html>
