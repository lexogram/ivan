<!DOCTYPE html>
<html lang=en>
<head>
<meta charset="utf-8">
<title>Chrome extension</title>
<link rel="stylesheet" href="../css/core.css" />
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
</head>

<body>
  <div class="sidebar">
    <div class="logo">
      <a href="../"><img src="../img/logo.png" alt="openbook home" /></a>
    </div>

    <nav>
      <ol>
        <li><a href="#top">Overview</a></li>
        <li><a href="#waiver">Waiver</a></li>
        <li><a href="#intro">Introduction</a></li>
        <li><a href="#basic">A basic extension</a></li>
        <li><a href="#window">A standalone window</a></li>
        <li><a href="#meteor">Creating a Meteor site</a></li>
        <li><a href="#connection">Creating a connection</a></li>
        <li><a href="#actions">Detecting user actions</a></li>
        <li><a href="#call">Talking to the server</a></li>
        <li><a href="#messages">Sending messages</a></li>
        <li><a href="#server">Server-side with Meteor</a></li>
        <li><a href="#tbd">TBD</a></li>
        <li><a href="#end">Conclusion</a></li>
      </ol>
    </nav>
  </div>

<main>
<header>
  <a href="https://github.com/lexogram/openbook/blob/master/LICENSE" class="cc">&#59409;</a>
  <h1>Annotations : a Chrome extension</h1>
  <ul class="nav">
    <li>
      <a href="#back"><img src="../img/arrow.png" alt="back" /></a>
    </li><li>
      <a href="#next"><img src="../img/arrow.png" alt="next" /></a>
    </li>
  </ul>
</header>

<article>
<!-- WAIVER -->
<section id="waiver">
  <div class="aside warn"><span class="h2">Waiver</span>
    <p>To weave its magic, the Annotations extension makes permanent records of your actions in a database on the server at lexogram.com.</p>
    <ul>
      <li>It records the IP address that is assigned to you at the moment when you start using the Annotations extension</li>
      <li>It records what pages you have visited, and on what dates</li>
      <li>It stores a copy of the text of each page you visit</li>
      <li>It stores the personal notes that you make, and, with your permission, may share these notes anonymously with other people</li>
    </ul>
     <p>From this information, the server generates a profile of your language skills which may become more and more accurate the more you use the Annotations extensions and the Lexogram service.</p>
     <p>You may register with Lexogram using a unique username and password, so that you can keep track of your learning on different computers and share the same computer with different learners. You may provide an email address or a cell phone number, in order to reset your password. If you do so, then it will be technically possible to connect the activity associated with your account to you personally. Even if you don't register, your IP address may provide enough information to identify you.</p>
     <p>Lexogram uses this data only to provide you with a service that we hope you will find valuable. Lexogram does not provide any information concerning your activities to any third parties. Lexogram does its best to keep its servers secure from malicious attacks. However, Lexogram cannot guarantee that your personal use of the Annotations extension and the Lexogram infrastructure will remain private forever. By using the Annotations extension, you agree to refrain from any activity that you might regret, and never to hold Lexogram responsible in any way for anything that happens as a result of your use of the services that Lexogram provides.</p>
  </div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#intro">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- INTRODUCTION -->
<section id="intro">
  <h2>Introduction to Chrome extensions</h2>
  <p>A Chrome extension can consist of several moving parts:</p>
  <ul>
  <li>A clickable icon that appears in the Chrome toolbar to the right of the address bar omnibox</li>
  <li>An HTML page that can open either as a popup or as a separate window</li>
  <li>"Background" code that is loaded and run as soon as Chrome is launched. This defines what happens when you click on the toolbar icon</li>
  <li>"Content" code that can be injected into pages that you visit while the extension is enabled, and which run after the page has loaded</li>
  <li>CSS that is injected into every page while the extension is enabled.</li>
  </ul>
  <p class="aside info">The injected data (code and CSS) is not applied to the extension's custom HTML page.</p>
  <p>The Chrome browser provides a number of proprietary methods to call methods in the <span class="keyword">background</span> code or in another window or tab. This means that you can inject code into the pages that your user will visit, and use that to communicate between tabs and windows, via the <span class="keyword">background</span> code.</p>
  <p>You can arrange for an HTML page to open when you click the extension icon. You can also use the injected <code>content</code> code to modify the DOM and the CSS of the main page.</p>
   <div class="aside preview">In this tutorial, you will see how to use these techniques to:
   <ul>
  <li>Add a toolbar at the top of the main page</li>
  <li>Replace the <code>body</code> of the page with a modified copy, so that you can change the colour of individual words</li>
  <li>Display a reactive <a href="https://www.meteor.com/" class="plain">Meteor</a> web site in the custom window</li>
  <li>Tell your Meteor server about the user's actions in a third-party web page</li>
  <li>Use information that you retrieve from your server to update the Notebook window and to customize the appearance of the third-party page</li>
  </ul>
  </div>
  <figure>
  <img src="img/communications.png" alt="How the different modules communicate" />
  <figcaption>Figure 2. How the different modules communicate</figcaption>
  </figure>
  <p class="aside note">For this tutorial, the Meteor website that you will be working with will be a simple proof-of-concept prototype, with just enough features to show how the Chrome extension messaging system works. A <a href="../notebook/">forthcoming tutorial</a> will deal with the more advanced features of the Meteor site.</p>

  <footer>
    <ul class="nav">
    <li>
    <a href="#basic">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- BASIC EXTENSION -->
<section id="basic">
<h2>Creating a basic extension</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to create a manifest.json file to define your extension</li>
<li>How to create a button for the Chrome Toolbar</li>
<li>How to create a page to display when the button is pressed</li>
<li>How to activate your extension</li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/01_basic_extension.zip" target="source">Download the source files</a>
</div>

<p>To create the simplest possible extension, you will need to create three files:</p>
<dl>
  <dt>manifest.json</dt>
  <dd>This file tells Chrome about your extension and how to find the other two files. It must be called "manifest.json". The other files can have any name you want, so long as their names are recorded inside the <code>manifest.json</code> file.</dd>
  <dt>A 19 x 19 pixel image</dt>
  <dd>This will be used to create a button in the Chrome toolbar. In the <code>manifest.json</code> file shown below, it is named <code>icon.png</code>.</dd>
  <dt>A simple HTML file</dt>
  <dd>This contents of this file will be displayed in a window when you click on the Chrome toolbar icon. In the <code>manifest.json</code> file shown below, it is named <code>popup.html</code>.</dd>
</dl>
<h3>manifest.json</h3>
<p>The <code>manifest.json</code> file is in <a href="http://www.json.org/">JSON</a> format. It can contain a wide range of information. The essential details are shown below.</p>
<pre>{
  "manifest_version": 2

, "name": "Annotations"
, "version": "alpha"
, "description": "Helps you save and share notes about web pages"

, "browser_action": {
    "default_icon": "icon.png"
  , "default_popup": "popup.html"
  }

, "permissions": [
    "activeTab"
  ]
}</pre>
<div class="aside note">Notes on the essential fields used in manifest.json
  <ul>
  <li><code>manifest_version</code> must be <code>2</code> in order to ensure that all the features mentioned in this tutorial are available.</li>
  <li>In the Chrome Extensions management page, <code>name</code> will be used as the name of the extension. It may also be used as the tooltip when you roll your mouse over the extension's icon. The name does not have to be unique. It should be 45 characters or less.</li>
  <li>The <code>version</code> must be a string of between 1-4 dot-separated integers each between 0 and 65536, such as "1" or "4.32.1.0"</li>
  <li>The <code>description</code> is optional. It should be a plain text string (no HTML or other formatting) of 132 characters or less. The description will be used both in the Chrome extension page and in the Chrome Web Store.</li>
  <li>There are two types of extension: <a href="https://developer.chrome.com/extensions/browserAction">browser_action</a>  extensions that can be used with any page, and <a href="https://developer.chrome.com/extensions/pageAction">page_action</a> extensions that will only be activated if the current page fits a particular set of criteria. The Annotations extension is designed for use with any page, so this <code>manifest.json</code> file contains an entry for <code>browser_action</code>.</li>
  <li>If no <code>default_icon</code> is provided, then the button in the Chrome toolbar will use the first letter of the <code>name</code> to create an image for the button. You can use in image of any size, but it will be redimensioned to 19 x 19 pixels, so it's best to create an image at that size.</li>
  <li>The simplest action for an extension is to display a popup window when the toolbar button is clicked. To see this in action, for now, you can create a simple HTML page. However, the Annotations extension will not use a popup window, so the <code>default_popup</code> entry will be removed later.</li>
  <li>Users must grant an extension <code>permissions</code> to access any personal information. The lowest level of permission is access to the data on the current page or <code><a href="https://developer.chrome.com/extensions/activeTab">activeTab</a></code>. You'll need to add other permissions later.</li>
  </ul>
</div>

<figure>
<img src="img/tooltip.png" alt="extension tooltip" />
<figcaption>Figure 3. The <code>name</code> appears as a tooltip on rollover</figcaption>
</figure>

<h3>The default_popup file</h3>
<p>For the Annotations extension, you will be opening a new window rather than using a popup, but to get started, you can create a file named <code>popup.html</code> with the following minimal content:</p>
<pre>&lt;!DOCTYPE html&gt;
&lt;body&gt;
&lt;h1&gt;Popup&lt;/h1&gt;
&lt;p&gt;More stuff can go here&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>

<h3>Loading your extension</h3>
<p>Place your <code>manifest.json</code>, <code>popup.html</code> and <code>icon.png</code> files in the same folder on your hard drive (or <a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/01_basic_extension.zip" target="source">download the source files</a> and decompress them). Open Chrome and type <code>chrome://extensions</code> in the address omnibox, then press the Enter key.</p>
<figure>
<img src="img/load.png" alt="loading your extension" />
<figcaption>Figure 4. Loading your extension</figcaption>
</figure>
<p>Make sure the Developer Mode checkbox is selected, and then click on the Load Unpacked Extension button. A dialogue window will open; you can select the folder in which you saved your three files. The icon that you chose will appear in a button to the right of the address omnibox. If you click on it, a popup window will open to display your HTML page.</p>

<figure>
<img src="img/basic.png" alt="popup window" />
<figcaption>Figure 5. The <code>default_popup</code> appears when you click on the icon</figcaption>
</figure>

<div class="aside next">In this section, you've created a minimalist Chrome extension that opens a popup window. You seen the importance of the <code>manifest.json</code> file and how to tell Chrome that your extension exists.
<p>In the <a href="#window">next section</a>, you'll see how to create a background script to open a stand-alone window.</p>
</div>
<div class="optional tips">
<input type="checkbox" id="icon-tips"/>
<label for="icon-tips">Tip: Additional Icons</label>
<div>
<p>Currently, a generic icon is used for your extension in the Chrome Extensions management page.</p>
<figure>
<img src="img/default_icon.png" alt="default icon" />
<figcaption>Figure 6. The default Chrome extension icon</figcaption>
</figure>
<p>It's a good idea to create additional icons that will be used on the Extensions management page, in the Chrome Web Store, during the installation of your extension, and as the favicon of any browser pages your extension might create.</p>
<p>You can <a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/01a_additional_icons.zip" target="source">download the source files</a> for a slightly more complex extension which places all the icon files in the same <code>img</code> folder, and gives them names that indicate their sizes.</p>
<pre class="revised">{
  "manifest_version": 2

, "name": "Annotations"
, "version": "1.0"
, "description": "Helps you save and share notes about web pages."

, "browser_action": {
    "default_icon": "<span class="new">img/</span>icon<span class="new">19</span>.png"
  , "default_popup": "popup.html"
  }

, "permissions": [
    "activeTab"
  ]

<span class="new">, "icons": {
    "16": "img/icon16.png"
  , "48": "img/icon48.png"
  , "128": "img/icon128.png"
  }</span>
}</pre>
<p>If you use this version of the extension, you'll see a custom icon for your extension in the Extensions management page.</p>
<figure>
<img src="img/custom_icons.png" alt="custom icons" />
<figcaption>Figure 7. A custom icon for your extension</figcaption>
</figure>
<p>You can find more information about this on the <a href="https://developer.chrome.com/apps/manifest/icons">Chrome Developer site</a>.</p>
</div>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#window">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- WINDOW -->
<section id="window">
<h2>A standalone window</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to create a background script that will be loaded as soon as Chrome is launched</li>
<li>How to call a method in the background script when the extensions toolbar button is clicked</li>
<li>How to tell Chrome to open a new window to display a specific URL</li>
<li>How to debug a background script</li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/02_standalone_window.zip" target="source">Download the source files</a>
</div>

<h3>Declaring a background script</h3>
<p>In your <code>manifest.json</code> file, you can declare scripts that will be added to an automatically-generated <span class="keyword">background</span> page. Chrome will create the page when it first starts up (or when you reload your extension) but will never show it. You can use the background page to load scripts that will be available at all times the browser is open. Here's how you can modify your <code>manifest.json</code> file so that it loads a script called <code>background.js</code>:</p>

<pre class="revised">{
  "manifest_version": 2

, "name": "Annotations"
, "version": "1.0"
, "description": "Helps you save and share notes about web pages."

, "browser_action": {
    "default_icon": "img/icon19.png"
  }

, "permissions": [
    "activeTab"
  ]

, "icons": {
    "16": "img/icon16.png"
  , "48": "img/icon48.png"
  , "128": "img/icon128.png"
  }

<span class="new">, "background": {
    "scripts": [
      "js/background.js"
    ]</span>
  }
}</pre>

<h3>background.js</h3>
<p>You can create a file called <code>background.js</code> with the following script. Notice that it refers to another file called <code>popup.html</code>; you can use the existing file with that name for now.</p>
<p>Notice that the script uses a custom <code>notify()</code> method to both show an alert and log data in the console. You'll see shortly how to bring up the console where you can see the logged data. You'll also notice that this script makes calls to methods that are defined on a global <code>chrome</code> object.</p>

<pre>"use strict"

;(function background(){

  function notify() {
    console.log.apply(console, arguments)
    alert(arguments[0])
  }

  function useExtension() {
    notify ("useExtension triggered")

    var URL = <span class="red">chrome.extension.getURL</span>("html/popup.html")
    var width = 300
    var top = 0

    var options = {
      url: URL
    , left: screen.availWidth - width
    , top: top
    , width: width
    , height: screen.availHeight - top
    , focused: false
    , type: "popup" // "normal"
    }

    <span class="red">chrome.windows.create</span>(options, callback)

    function callback(window_data) {
      notify ("window opened", window_data)
    }
  }

  <span class="red">chrome.browserAction.onClicked.addListener</span>(useExtension)
  notify ("Background script loaded")
})()</pre>

<h3>Reloading your extension</h3>
<p>Here's how your files should be organized now, so that the <code>manifest.json</code> file can find them all:</p>
<figure>
<img src="img/background_js.png" alt="file hierarchy" />
<figcaption>Figure 8. The new arrangement of your extension files</figcaption>
</figure>

<p>Each time you make a change to your extension, you need to tell Chrome to reload it. You can do this by clicking on the Reload link for your extension in the Chrome Extensions management window.</p>

<figure>
<img src="img/reload.png" alt="Reload your extension and open the Inspector window for the background page" />
<figcaption>Figure 9. Reload your extension and open the Inspector window for the background page</figcaption>
</figure>

<h3>Debugging a background script</h3>
<p>As you can see in Figure 9, abovo, when you reload your extension after adding a background script, you will see a new Inspect Views link in the Extension management panel, which allows you to open a Developer Tools Inspector window for the <span class="keyword">background</span> page which Chrome has now created. When you activate your extension, your <code>popup.html</code> page should open in a new window. You'll see that the output of the <code>console.log()</code> command appears in the Console in the Inspector window for your <span class="keyword">background</span> page.</p>

<h3>The <code>chrome</code> object</h3>
<p>It's time now to look closer at what your <code>background.js</code> script is doing, and especially at the following three lines:</p>

<pre><span class="red">chrome.extension.getURL</span>("html/popup.html")

<span class="red">chrome.windows.create</span>(options, callback)

<span class="red">chrome.browserAction.onClicked.addListener</span>(useExtension)</pre>

All scripts running in Chrome have access to a  object named <code>chrome</code>. However, scripts running in a standard window and script running in the <span class="keyword">background</span> have access to different objects that have the same name.
<figure>
<img src="img/page_chrome.png" alt="page chrome object" />
<figcaption>Figure 10. The <code>chrome</code> object available in standard windows</figcaption>
</figure> 

<figure>
<img src="img/background_chrome.png" alt="background chrome object" />
<figcaption>Figure 11. The <code>chrome</code> object available to background scripts</figcaption>
</figure>
<p>As you can see from Figure 11, the <code>chrome</code> object that is available to <span class="keyword">background</span> scripts posseses a number of extension-specific properties:</p>
<ul>
<li><code><a href="https://developer.chrome.com/extensions/browserAction">browserAction</a></code> </li>
<li><code><a href="https://developer.chrome.com/extensions/extension">extension</a></code> </li>
<li><code><a href="https://developer.chrome.com/extensions/i18n">i18n</a></code> (i<em>nternationalizatio</em>n)</li>
<li><code><a href="https://developer.chrome.com/extensions/management">management</a></code> </li>
<li><code><a href="https://developer.chrome.com/extensions/permissions">permissions</a></code> </li>
<li><code><a href="https://developer.chrome.com/extensions/tabs">tabs</a></code> </li>
<li><code><a href="https://developer.chrome.com/extensions/windows">windows</a></code> </li>
</ul>
<p>You will be using several of these background extension objects as you develop your extension, as well as the <code>chrome.runtime</code> object that is available in standard web pages.</p>
<h4><code>chrome.extension</code></h4>
<p>The <code>chrome.extension</code> API provides support for exchanging messages between extensions or between an extension and its content scripts that have been injected into the pages in a standard window.</p>
<p>The <code><a href="https://developer.chrome.com/extensions/extension#method-getURL">chrome.extension.getURL()</a></code> method converts a relative path such as <code>"html/popup.html"</code> into a fully-qualified URL: <code>"chrome-extension://maabmcngoiolpokniappbcolnflbgopo/html/popup.html"</code> </p>
<h4><code>chrome.windows</code></h4>
<p>You can use the <code>chrome.windows</code> API to create, modify, and rearrange windows in the browser.</p>
<p>The <code><a href="https://developer.chrome.com/extensions/windows#method-create">chrome.windows.create(options, callback)</a></code> opens a new browser window with any optional sizing, position or default URL that you provide in the <code>options</code> argument.</p>
<h4>chrome.browserAction</h4>
<p>The <code>chrome.browserAction</code> allows you to control the extension button in the Chrome toolbar. You can modify its appearance, its title, and whether it is enabled. You can also detect when it is clicked, using the <code>chrome.browserAction.onClicked</code> event. The code above sets a listener for this event, and uses that to open a custom window with a specified position and size.</p>
<p class="aside note">The listener for the <code>chrome.browserAction.onClicked</code> event will be triggered every time the toolbar button is clicked, not just the first time. Later you will be modifying this code so that it reacts differently if the extensions custom window is already open.</p>
<h4>Window <code>type</code></h4>
<p>The <code><a href="https://developer.chrome.com/extensions/windows#type-CreateType">type</a></code> of the window is set to <code>"popup"</code>. This creates a window with no toolbar, so the user cannot navigate to another page in this window. There are four possible values for <code>type</code>:</p>
<ul>
<li><code>"normal"</code> (default)</li>
<li><code>"popup"</code></li>
<li><code>"panel"</code></li>
<li><code>"detached_panel"</code></li>
</ul>
<p>At the time of writing, <code>"popup"</code>, <code>"panel"</code> and <code>"detached_panel"</code> all have the same effect.</p>
<figure>
<img src="img/normal_window.png" alt='A window with a type of "normal"' />
<figcaption>Figure 12. A window with a <code>type</code> of "normal"</figcaption>
</figure>
<figure>
<img src="img/popup_window.png" alt='A window with a <code>type</code> of "popup"' />
<figcaption>Figure 13. A window with a <code>type</code> of "popup"</figcaption>
</figure>

<h3>The <code>Window</code> object</h3>
<p>When <code>chrome.windows.create(options, callback)</code> is run, it activates an optional callback, and sends a <code>Window</code> object as the argument:</p>
<pre>{ alwaysOnTop: false
, focused: false
, height: 777
, id: 161
, incognito: false
, left: 880
, state: "normal"
, tabs: [
    active: true
  , audible: false
  , height: 682
  , highlighted: true
  , id: 162
  , incognito: false
  , index: 0
  , mutedInfo: Object
  , pinned: false
  , selected: true
  , status: "loading"
  , width: 400
  , windowId: 161
  ]
, top: 23
, type: "normal"
, width: 400
}</pre>

<div class="aside next">In this section, you've set up a a background script to react to a click on the toolbar button for your extension, and you've used that action to open a custom window. You've also seen how to open a Developer Tools Inspector window, so that you can debug your background script.
<p>You've used the following expressions that are specific to Chrome extensions:</p>
<ul>
<li><code>"background"</code> </li>
<li><code>chrome.extension.getURL()</code> </li>
<li><code>chrome.windows.create()</code> </li>
<li><code>chrome.browserAction.onClicked.addListener()</code></li>
</ul>
<p>In the <a href="#meteor">next section</a>, you'll see how to install and run a Meteor web server on your development computer, and you'll get your custom popup window to display the site running on your Meteor server.</p>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#toolbar">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- METEOR -->
<section id="meteor">
<h2>Creating a Meteor site</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to install Meteor on your development computer</li>
<li>How to view the default Meteor app in your extension popup window</li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/03_meteor.zip" target="source">Download the source files</a>
<a href="https://www.meteor.com/install">Install Meteor</a>
</div>

<p><a href="https://www.meteor.com/">Meteor</a> is an open-source platform for creating reactive web sites in pure JavaScript. It runs on Windows, OSX and Linux and it allows you to write code that runs on the server or in the browser in one place and in one language. To deliver a very basic web page using Meteor takes a little time, but virtually no effort.

<h3>Installing Meteor</h3>
<p>It's easy to install Meteor on your development machine. First make sure that you are connected to the Internet.</p>

<h4>Windows</h4><p>If you are on Windows, simply <a href="https://install.meteor.com/windows">download the installer</a> and run it.</p>
<h4>OSX and Linux</h4>
<p>If you are on OSX or Linux, you can install Meteor from a <a href="../html/terminal.html">Terminal window</a>. You need to use the Terminal as an administrator.
<div class="aside tip">If you are working from a non-admin account, you'll need to start by logging in as an admin:
<pre class="revised"><span class="new">su <em>admin</em></span>
Password:•</pre>
<p>Use the name of an administrator for your computer rather than <em>admin</em>, then type your password.</p></div>
<p>In a Terminal window, type ...</p>
<pre>curl https://install.meteor.com/ | sh</pre>
<p>... and wait while the latest version of Meteor is automatically installed. The Terminal window will fill up with something like this:</p>
<pre class="revised">  %  Total  % Received  % Xferd  Average Speed    Time     Time
                                 Dload  Upload    Total    Spent
100   7592  0     7592  0     0   5873       0  --:--:--  0:00:01 
Removing your existing Meteor installation.
Downloading Meteor distribution
########################################################## 100.0%
Meteor 1.3.4 has been installed in your home directory (~/.meteor)
Writing a launcher script to /usr/local/bin/meteor for your
convenience.
This may prompt for your password.
Password:•
</pre>
<p>Enter your admin password when you see the prompt for it, to complete the installation. If you did not run the <code>curl</code> command as an administrator, this step may fail.</p>

<h3>Creating the default Meteor web site</h3>
<p>In the Terminal window, use the <code><a href="http://www.computerhope.com/unix/ucd.htm">cd</a></code> command to navigate to the directory where you want to create your Meteor web site, and enter the following commands:</p>
<pre>meteor create NoteBook
cd NoteBook
meteor</pre>
<p>The first command may take a few minutes, as Meteor performs all the actions necessary for populating the <code>notebook</code> folder. When all is done, your folder should contain five items, including two that may be invisible: <code>.gitignore</code> and <code>.meteor</code>.</p>
<figure>
<img src="img/meteor_folder.png" alt="Contents of the notebook folder" />
<figcaption>Figure 14. Contents of the NoteBook folder</figcaption>
</figure>

<p>When you run the final <code>meteor</code> command, you'll see a series of actions logged to the Terminal window, as the Meteor application launches. Finally, you should see something like this:</p>

<pre>
[[[[[ <em>/Path/to/the/folder/NoteBook</em> ]]]]]

=> Started proxy.                             
=> Started MongoDB.
=> Started your app.                          

=> App running at: http://localhost:3000/
</pre>
<p class="aside note">When you want to stop the Meteor app, press <code>Ctrl-C</code></p>
<p class="aside note"><a href="https://www.mongodb.com/">MongoDB</a> is a free open-source cross-platform document-oriented database. It stores data in a JSON-like format, similar to the format of the <code>manifest.json</code> document you created earlier. (TODO: add reference to Neo4j?)</p>

<h3>Displaying the Meteor web page in the popup window</h3>
<p>You can test that the Meteor server is running by visiting <a href="http://localhost:3000/">http://localhost:3000/</a> in your browser. To get the Meteor page to show in your extensions popup window, you need to make some changes to your <code>background.js</code> script, as shown below.</p>
<pre class="revised">"use strict"

;(function background(){

  <span class="new">var windowOpen = false</span>

  function useExtension() {
    <span class="new">if (windowOpen) {
      return
    }</span>

    var URL = <span class="new">"http://localhost:3000/"</span>
    var width = 300
    var top = 0

    var options = {
      url: URL
    , left: screen.availWidth - width
    , top: top
    , width: width
    , height: screen.availHeight - top
    , focused: false
    , type: "popup"
    }

    chrome.windows.create(options, callback)

    function callback(window_data) {
      <span class="new">windowOpen = true</span>
    }
  }

  chrome.browserAction.onClicked.addListener(useExtension)
})()</pre>
<p>The most important change is setting the <code>URL</code> to <code>"http://localhost:3000/"</code> so the window shows your Meteor site. The other changes ensure that the window is only opened once, the first time you click on the toolbar button.</p>
<p class="aside note">Right now, if you close the popup window, then it will stay closed until you relaunch Google or reload your extension. In <a href="#">TODO</a>, you will be adding code that resets <code>windowOpen</code> to false when the window is closed.</p>
<p>When you reload your extension and click on the toolbar button, you should see something like this:</p>
<figure>
<img src="img/meteor_default.png" alt="The default Meteor page in your extensions popup window" />
<figcaption>Figure 15. The default Meteor page in your extensions popup window</figcaption>
</figure>

<p class="aside note">The default Meteor site doesn't do anything that you want it to do yet. If you've never used Meteor before you may want to follow the Learn Meteor links that are shown in the window, in order to gain an understanding of the Meteor development environment. However, this is not essential; this tutorial covers all the basics that you will need to know.</p>

<div class="aside next">In this section, you've seen how simple it is to install Meteor and to launch a default web site. You've also seen how to get the popup window of your extension to display this Meteor web site.
<p>In the <a href="#connection">next section</a>, you'll start modifying the Meteor NoteBook app and see how to get its page script to communicate with the extension's background script.</p>
</div>

<p class="aside support">If you have any difficulty anywhere in this tutorial, please <a href="https://github.com/lexogram/openbook/issues/new">tell us about it</a>, and we'll do our best to deal with it for you. Your questions and suggestions can help us make this tutorial better.

  <footer>
    <ul class="nav">
    <li>
    <a href="#connection">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- CONNECTION -->
<section id="connection">
<h2>Creating a connection between the page script and the background</h2>
<p>In this section, to check that the connection is working, you'll create a simple "ping" feature in your background script, and use this to increment a number in the NoteBook. Once this counting system is working, you can replace it with more useful features.</p>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to allow a page script to communicate with your extension's background script</li>
<li>How to open a two-way connection between a page script and your extension's background script</li>
<li>How to send a messages between the page script and the background</li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/04_connection.zip" target="source">Download the source files</a>
</div>
<p>When the Annotation extension is fully working, the following flow of actions will occur when you select a word or phrase in a web page that you visit:</p>

<ol>
<li>A <span class="keyword">content script</span> in the web page will tell the <span class="keyword">background script</span> about the selection</li>
<li><strong>The <span class="keyword">background script</span> will forward information to a <span class="keyword">page script</span> in the NoteBook window</strong></li>
<li>The <span class="keyword">client-side page script</span> in the NoteBook window will send a message to a <span class="keyword">server-side script</span> on the Meteor server</li>
<li>The <span class="keyword">server-side script</span> will query a <span class="keyword">database</span></li>
<li>The <span class="keyword">server-side script</span> will send the result of the database query back to the <span class="keyword">client-side page script</span> in the NoteBook window</li>
<li>The NoteBook window will update</li> 
<li><strong>The <span class="keyword">page script</span> in the NoteBook window will send some of the information it received to the <span class="keyword">background script</span></strong></li>
<li>The <span class="keyword">background script</span> will forward the information to the <span class="keyword">content script</span> in the web page you are reading</li>
<li>The display of the web page will update.</li>
</ol>
<p class="aside note">In this tutorial, the interactions with the database mentioned in steps 4 and 5 will be simulated. They will be covered in a <a href="../notebook/">separate tutorial</a>.</p>
<p>This section deals with setting up the connections that you will need to deal with the two items shown in bold above.</p>

<h3><code>manifest.json</code></h3>
<p>As you've already seen, the <code>manifest.json</code> controls the files that your extension can use. For the sake of security, before your extension can accept a connection coming from a script in a web page, you must provide a filter to identify the web pages that should be allowed to connect.</p>
<p>This is done with the <code><a href="https://developer.chrome.com/extensions/manifest/externally_connectable">"externally_connectable"</a></code> manifest property. To allow any page script from your Meteor site to connect with your extension's background script, you can provide as <code>"matches"</code> array, containing the pattern <code>"http://localhost:*/*"</code>. This will match with <code>"http://localhost:3000/"</code>, or any custom port number that you have set Meteor to run on.</p>
<pre class="revised">{
  "manifest_version": 2

, "name": "Annotations"
, "version": "1.0"
, "description": "Helps you save and share notes about web pages."

, "browser_action": {
    "default_icon": "img/icon19.png"
  }

, "permissions": [
    "activeTab"
  ]

, "icons": {
    "16": "img/icon16.png"
  , "48": "img/icon48.png"
  , "128": "img/icon128.png"
  }

, "background": {
    "scripts": [
      "js/background.js"
    ]
  }

<span class="new">, "externally_connectable": {
    "matches": ["http://localhost:*/*"]
  }</span>
}</pre>

<h3>The Meteor client files</h3>
<p>The default Meteor app contains three files inside the <code>client</code> folder: <code>main.html</code>, <code>main.css</code> and <code>main.js</code>. These currently define the default Meteor app. You can edit them now, to start customizing the NoteBook.</p>

<figure>
<img src="img/meteor_client.png" alt="The three files inside the Meteor client folder" />
<figcaption>Figure 16. The three files inside the Meteor client folder</figcaption>
</figure>

<h4><code>main.html</code></h4>
<p>Delete everything inside <code>main.html</code> and replace it with this:</p>
<pre>&lt;head&gt;
  &lt;title&gt;NoteBook&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;p id="selection"&gt;&lt;/p&gt;
&lt;/body&gt;</pre>

<h4><code>main.css</code></h4>
<p>The <code>main.css</code> file is probably more or less empty. You can use this rule to make the <code>#selection</code> paragraph visible even if it's empty:</p>
<pre>p#selection {
  min-height: 2em;
  width: 100%;
  background-color: #ddd;
  border: 1px solid #ccc;
  border-bottom-color: #eee;
  border-right-color: #eee;
}</pre>

<figure>
<img src="img/notebook_00.png" alt="The new-look NoteBook" />
<figcaption>Figure 17. The new-look NoteBook</figcaption>
</figure>

<h3>A two-way connection</h3>
<p>To create a two-way connection between the page script of your Meteor app and the background script of your extension, you can use the <code><a href="https://developer.chrome.com/extensions/runtime#method-connect">chrome.runtime.connect</a></code> method. This command requires the unique <code>ID</code> of your extension. You can find this in the Chrome Extension management window:</p>

<figure>
<img src="img/extensionID.png" alt="Finding your extension ID" />
<figcaption>Figure 18. Finding your extension ID</figcaption>
</figure>

<h4><code>main.js</code></h4>
<p>Delete everything inside <code>main.js</code> and replace it with the following code. You'll get the change to edit it again before you're done.</p>
<pre>Meteor.startup(function() {
  var extensionID = "<em class="revised">use your own extension ID here</em>"
  var port = chrome.runtime.connect(extensionID)
  var message = { method: "startCounter" }

  setTimeout(function () {
    port.postMessage(message)
  }, 1)
})</pre>

<div class="aside note">Notes on the <code>main.js</code> script
<ul>
<li><code><a href="https://docs.meteor.com/api/core.html#Meteor-startup">Meteor.startup()</a></code> is a function provided by Meteor that will run as soon as the DOM is ready. It's good to use it to wrap initializiation code.</li>
<li>For <code>extensionID</code>, use the value that you can copy from the Chrome Extension management window, as shown in Figure 18. If you use the wrong value, nothing will happen.</li>
<li>The <code><a href="https://developer.chrome.com/extensions/runtime#type-Port">port</a></code> object returned by <code>chrome.runtime.connect(extensionID)</code> provides a <code>postMessage</code> function, which you can use to send messages to the background script. In a moment, you'll also discover the port's <code>onMessage</code> object, which allows you to listen for incoming messages from the background.</li>
<li>When <code>chrome.runtime.connect(extensionID)</code> is called, any listener function attached to the <code>chrome.runtime.onConnectExternal</code> object in the background script will be called, as you will see in a moment. The listener function will be passed its own <code>port object</code> which can be used to send and receive messages in the same way as in the page script.</li>
<li>The call to <code>port.postMessage(message)</code> will be picked up by any listeners set on the background port's <code>onMessage</code> object.</li>
<li>It helps to delay the call to <code>port.postMessage</code> slightly, presumably to give the <code>port</code> object time to initialize.</li>
</ul>
</div>
<p class="aside tip">The code to set up a connection between a page script and a background script must be placed in the page script. If you need to initialize a connection to a page from a background script, you must do it via an injected <span class="keyword">content script</span>, as you will see in the next section: <a href="#actions">Detecting user actions</a>.</p>

<p>The background script below sets up the <code>openConnection</code> function as a listener for <code><a href="https://developer.chrome.com/extensions/runtime#event-onConnectExternal">chrome.runtime.onConnectExternal</a></code>, which fires when a <code>runtime.connect</code> connection is made from another extension or, as in this case, from a page script. The <code>openConnection</code> function receives a <code>port</code> object as an argument, saves it for use later and sets up a listener on it for incoming messages.</p>

<h4><code>background.js</code></h4>

<pre class="revised">"use strict"

;(function background(){

  <span class="new">var timeout = 0
  var port</span>

  function useExtension() {
    if (port) {
      return
    }
    
    var URL = "http://localhost:3000/"
    var width = 300
    var top = 0

    var options = {
      url: URL
    , left: screen.availWidth - width
    , top: top
    , width: width
    , height: screen.availHeight - top
    , focused: false
    , type: "popup"
    }

    chrome.windows.create(<span class="new">options</span>)
  }

  <span class="new">function openConnection(externalPort) {
    port = externalPort
    port.onMessage.addListener(incoming)
  }

  function incoming(message) {
    if (timeout) {
      clearTimeout(timeout)
    }
    ping()
  }

  function ping() {
    port.postMessage({ method: "ping", counter: timeout })
    timeout = setTimeout(ping, 1000)
  }

  chrome.runtime.onConnectExternal.addListener(openConnection)</span>
  chrome.browserAction.onClicked.addListener(useExtension)
})()</pre>

<p>After the <code>port</code> is set up, it waits for an incoming message. This is sent from <code>main.js</code> after a 1 ms timeout, and it is handled by the <code>incoming</code> listener function. The output of the <code>setTimeout</code> method is an incrementing integer, and for elegance, this is used as the counter that is sent every second to the NoteBook script.</p>

<h3><code>main.js</code> revisited</h3>
<p>In its current state, the Notebook page script knows nothing about the message that is sent to it. You can add a listener to the <code>port</code> object, and use this to update the <code>#selection</code> paragraph.</p>
<pre>Meteor.startup(function() {
  var extensionId = "<em class="revised">use your own extension ID here</em>"
  var port = chrome.runtime.connect(extensionId)
  var message = { method: "startCounter" }
  <span class="new">var p = document.getElementById("selection")

  function incoming(message) {
    if (message.method === "ping") {
      p.innerHTML = message.counter
    }
  }

  port.onMessage.addListener(incoming)</span>

  setTimeout(function () {
    port.postMessage(message)
  }, 1)
})</pre>

<figure>
<img src="img/notebook_01.png" alt="The background script tells the page script to update the NoteBook" />
<figcaption>Figure 19. The background script tells the page script to update the NoteBook</figcaption>
</figure>

<div class="aside next">In this section, you've set up a two-way messaging system between the Meteor NoteBook page script and the background script, and tested that it is working. However, it's not doing anything very useful yet.
<p>You've used the following expressions that are specific to Chrome extensions:</p>
<ul>
<li><code>"externally_connectable"</code> </li>
<li><code>"matches"</code> </li>
<li><code>chrome.runtime.connect()</code> </li>
<li><code>chrome.runtime.onConnectExternal.addListener()</code> </li>
<li><code><em>port</em>.onMessage.addListener()</code></li>
<li><code><em>port</em>.postMessage()</code> </li>
</ul>
<p>You've used the following expression that is specific to Meteor:</p>
<ul>
<li><code>Meteor.startup(function () {...})</code> </li>
</ul>
<p>In the <a href="#actions">next section</a>, you'll see how to inject a <span class="keyword">content script</span> into an arbitrary web page, and use that to pass information from the web page to your NoteBook window, via the background script.</p>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#actions">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- ACTIONS -->
<section id="actions">
<h2>Detecting user actions in the main window</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to inject a "content" script into a third-party web page</li>
<li>How to send messages from an arbitrary page to your NoteBook, via the background script</li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/03_meteor.zip" target="source">Download the source files</a>
</div>

<p>One of the main features of the Annotation extension is that it allows you to select an expression (a word or a phrase) in any web page you visit, and then use the NoteBook window to explore the meanings of the expression. To get this to work, you need to inject a script into the pages you visit in the main window, and get this to communicate with the background script. The background script can then forward messages to your NoteBook window, using the technique you saw in the <a href="#connection">last section</a>.</p>
<p>As usual, the first step is to add a new manifest property to <code>manifest.json</code> to define a <a href="https://developer.chrome.com/extensions/content_scripts">content script</a>: a script that can be injected into every <span class="keyword">content</span> page that you visit. Or almost every page: you don't want to inject it into your NoteBook page. The structure of the definition is more complex than the ones you have seen so far, because Chrome requires you to create a filter for URLs, so that your script is only added to pages that match the filter.</p>

<pre class="revised">{
  "manifest_version": 2

, "name": "Annotations"
, "version": "1.0"
, "description": "Helps you save and share notes about web pages."

, "browser_action": {
    "default_icon": "img/icon19.png"
  }

, "permissions": [
    "activeTab"
  ]

, "icons": {
    "16": "img/icon16.png"
  , "48": "img/icon48.png"
  , "128": "img/icon128.png"
  }

, "background": {
    "scripts": [
      "js/background.js"
    ]
  }

, "externally_connectable": {
    "matches": ["http://localhost:*/*"]
  }

<span class="new">, "content_scripts": [ {
    "matches": ["&lt;all_urls&gt;"]
  , "exclude_matches": ["http://localhost:*/*"]
  , "js": [
      "js/content.js"
    ]
  } ]</span>
}</pre>

<h3><code>content_scripts</code></h3>
<p>The <a href="https://developer.chrome.com/extensions/content_scripts#registration"><code>content_scripts</code> manifest property</a> defines an array of map objects. Each object must include:</p>
<ul>
<li>A <code>"matches"</code> property, whose value must be an array of <a href="https://developer.chrome.com/extensions/match_patterns">match patterns</a>. Since you want the Annotation extension to run anywhere, you can use the pattern <code class='pre'>"&lt;all_urls&gt;"</code>.</li>
</ul>
<p>The object should also include one or both of the following:</p>
<ul>
<li>A <code>"js"</code> property, whose value is an array of URLs for javascript files</li>
<li>A <code>"css"</code> property, whose value is an array of URLs for CSS files</li>
</ul>

<p>For now, you don't need to inject any CSS, so it's enough to have the entry for <code>"js"</code>. You'll find the JavaScript code for the <code>content.js</code> file below.</p>

<p>In this case, you want to prevent the content script from being injected into your NoteBook pages, so you can include an optional <code>"exclude_matches"</code> property:</p>
<ul>
<li>The <code>"exclude_matches"</code> property is an array of <a href="https://developer.chrome.com/extensions/match_patterns">match pattern</a> strings. In this case you should use the same pattern that you used as a "match" for the <code>"externally_connectable"</code> property in the last section: <code>"http://localhost:*/*"</code>.</li>
</ul>

<h3><code>content.js</code></h3>
<p>Now you can create a file in the <code>js/</code> folder, called <code>content.js</code>. Its role will be to detect when the selected text in the page changes, and to inform the background script.</p>

<pre>"use strict"

;(function content(){

  var selectedText = ""

  function checkSelection(event) {
    var selection = document.getSelection()
    var text = selection.toString()
    var message

    if (selectedText !== text) {
      selectedText = text
      message = {
        method: "changeSelection"
      , data: selectedText
      }

      chrome.runtime.sendMessage(message)
    }
  }

  document.body.addEventListener("mouseup", checkSelection, false)
  document.body.addEventListener("keyup", checkSelection, false)
})()</pre>

<p>This content script sets up the <code>checkSelection</code> function as a listener for <code>mouseup</code> and <code>keyup</code> events. If the text selected in the page has changed, a message object is created, with a <code>method</code> and a <code>data</code> property. This message is then sent to the background script using <code><a href="https://developer.chrome.com/extensions/runtime#method-sendMessage">chrome.runtime.sendMessage</a></code> </p>

<div class="aside note">The <code>chrome.runtime.sendMessage</code> method is a simpler way of sending messages to the background script than setting up a port using <code>chrome.runtime.connect</code>, like you saw in the last section. It sets up a temporary connection for a single message and an optional response. A listener in the background script will receive three parameters:
<ul>
<li>The <code>request</code> object – in this case: <code>{ method: "changeSelection" , data: selectedText }</code></li>
<li>A <code>sender</code> object, indicating which content script sent the message</li>
<li>A <code>sendResponse</code> callback function that can be used to send a reply.</li>
</ul>
<p>In this case, no reply is needed, so <code>sender</code> and <code>sendResponse</code> is ignored in the background script below.</p></div>
<h3>background.js</h3>
<p>The two-way communication that you set up between the background script and your NoteBook page script in the last section only needs to work in one direction for now. In this section, the page script will still be initializing the connection, but it won't be sending any messages of its own to the background script, and the <code>ping</code> feature was just for testing, so you can remove it.</p>
<p>To respond to the <code>chrome.runtime.sendMessage()</code> call that you make in the content script, you can add the <code>treatMessage</code> function as a listener to the <code>chrome.runtime.onMessage</code> object. The <code>treatMessage</code> function below checks for a <code>method</code> property in the incoming <code>request</code>, and calls the appropriate function. For now, it only has one method to handle: <code>changeSelection</code>. By using a <code>switch</code> statement, you will easily be able to handle more method requests in the future.</p>
<p>The <code>changeSelection</code> function checks if the two-way port to the NoteBook page script is open, and if so, simply forwards the request.</p>
<div class="optional tips">
  <input type="checkbox" id="-details"/>
  <label for="-details">Learn more about the chrome object</label>
  <div>
<p>Chrome does not allow you to send a message directly from one tab to another: you must always pass through your extension's background script. The <code>chrome</code> object accessible to content scripts has no knowledge of other tabs. Only the <code>chrome</code> object available in the background script has a <code>tabs</code> property.</p>
<figure>
<img src="img/content_chrome.png" alt="The chrome object in content scripts has no tabs property" />
<figcaption>Figure 20. The <code>chrome</code> object in content scripts has no <code>tabs</code> property</figcaption>
</figure>
<p>Compare with the <code>chrome</code> objects you have already seen in other scopes:</p>
<figure>
<img src="img/page_chrome.png" alt="page chrome object" />
<figcaption>Figure 10. The <code>chrome</code> object available in standard windows</figcaption>
</figure> 

<figure>
<img src="img/background_chrome.png" alt="background chrome object" />
<figcaption>Figure 11. The <code>chrome</code> object available to background scripts</figcaption>
</figure>
  </div>
</div>
<pre class="revised">"use strict"

;(function background(){

  var port

  function useExtension() {
    // code omitted for clarity
  }

  function openConnection(externalPort) {
    port = externalPort
    port.onMessage.addListener(incoming)
  }

  function incoming(message) {
    <span class="new">// TODO</span>
  }

  <span class="new">function treatMessage(request, sender, sendResponse) {
    switch (request.method) {
      case "changeSelection":
        changeSelection(request)
      break
    }
  }

  function changeSelection(request) {
    if (!port) {
      console.log("Request not treated:", request)
      return
    }

    port.postMessage(request)
  }

  chrome.runtime.onMessage.addListener(treatMessage)</span>
  chrome.runtime.onConnectExternal.addListener(openConnection)
  chrome.browserAction.onClicked.addListener(useExtension)
})()</pre>

<h3>The NoteBook page script: <code>main.js</code></h3>
<p>The background script now use the <code>port.sendMessage</code> function to send a message to the page script in your NoteBook window. You can use a <code>switch</code> statement in the <code>incoming</code> function to forward the request to the appropriate function. In this case, all the <code>changeSelection</code> function needs to do it to set the <code>innerHTML</code> of the <code>#selection</code> paragraph to the string of text that was initially selected in the main window.</p>

<pre class="revised">Meteor.startup(function() {
  var extensionId = "<em>use your own extension ID here</em>"
  var port = chrome.runtime.connect(extensionId)
  var p = document.getElementById("selection")

  <span class="new">function incoming(request) {
    switch (request.method) {
      case "changeSelection":
        changeSelection(request.data)
      break
    } 
  }

  function changeSelection(selection) {
    p.innerHTML = selection
  }</span>

  port.onMessage.addListener(incoming)
})</pre>

<figure>
<img src="img/selected_text.png" alt="Text selected in the main window is copied to the NoteBook window" />
<figcaption>Figure 21. Text selected in the main window is copied to the NoteBook window</figcaption>
</figure>

<div class="aside next">In this section, you've used the <code>manifest.json</code> file to define a content script to inject into all third-party web pages. You've used <code>match</code> patterns to include and exclude the pages into which the content script is injected. You've used sent a one-off message to the background script, and used the two-way connection you created in the last section to forward it to your NoteBook window.
<p>You've used the following expressions that are specific to Chrome extensions:</p>
<ul>
<li><code>"content_scripts"</code> </li>
<li><code>"exclude_matches"</code> </li>
<li><code>chrome.runtime.sendMessage()</code> </li>
<li><code>chrome.runtime.onMessage.addListener()</code></li>
</ul>
<p>In the <a href="#call">next section</a>, you'll see how the client-side scripts in your Meteor NoteBook application can call methods on the Meteor server, and how to retrieve the result of the call.</p>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#call">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- CALL -->
<section id="call">
<h2>Calling Meteor methods on the server</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to </li>
<li>How to </li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/03_meteor.zip" target="source">Download the source files</a>
</div>

<div class="aside next">In this section, you've .
<p>In the <a href="#toolbar">next section</a>, you'll .</p>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#toolbar">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- TOOLBAR -->
<section id="toolbar">
<h2>Inserting a toolbar into the current tab</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to </li>
<li>How to </li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/04_toolbar.zip" target="source">Download the source files</a>
</div>

<div class="aside next">In this section, you've .
<p>In the <a href="#server">next section</a>, you'll .</p>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#server">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- SERVER -->
<section id="server">
<h2>Server-side scripts with Meteor</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to </li>
<li>How to </li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/03_meteor.zip" target="source">Download the source files</a>
</div>

<div class="aside next">In this section, you've .
<p>In the <a href="#tbd">next section</a>, you'll .</p>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#tbd">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- TBD -->
<section id="tbd">
<h2>TBD</h2>
<div class="aside preview">Here's what you'll learn in this section:
<ul>
<li>How to </li>
<li>How to </li>
</ul>
<a href="https://github.com/lexogram/notebook-extension/raw/master/tutorial/zips/03_meteor.zip" target="source">Download the source files</a>
</div>

<div class="aside next">In this section, you've .
<p>In the <a href="#end">next section</a>, you'll .</p>
</div>

  <footer>
    <ul class="nav">
    <li>
    <a href="#end">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>

<!-- CONCLUSION -->
<section id="end">
<h2>Conclusion</h2>
<div class="aside preview">Here's what you've learnt:
<ul>
<li>How to create a Chrome extension</li>
<li>How to modify the DOM of the main page</li>
<li>How to communicate between different pages</li>
<li>How to interact with your own server</li>
</ul>
</div>

<p>Well done! Now you're ready to add features to your Meteor server, to make the service provided by the extension even more valuable. Time for a <a href="../notebook/">new tutorial</a>.</p>
</section>

<!-- OVERVIEW -->
<section id="top">
  <h2>Overview</h2>
  <p class="top">Lexogram's <a href="#">Annotations</a> is a Chrome extension which helps you learn a language by making notes about web pages that you visit in the language that you are learning. This tutorial takes you step-by-step through the process of building version 1.0 of the Annotations extension.</p>
  <p>When you launch the Annotations extension, a popup window will open to display the Lexogram Notebook web site. The extension sets up communications between the page you have open in the main window and the Notebook, and provides a series of tools that help you understand and remember what you are reading.</p>

  <div class="aside preview">In particular, the Annotations extension:
    <ul>
      <li>Tells the Notebook window what text you have selected on the main page</li>
      <li>Allows you to make your own notes and translations, and saves them to the Lexogram server so that they can be shared with others</li>
      <li>Remembers which words and expressions you have become familiar with, and highlights those that it thinks will be new to you.</li>
    </ul>
  </div>

  <figure>
  <img src="img/overview.png" alt="The Annotations extension in action" />
  <figcaption>Figure 1. The Annotations extension in action</figcaption>
  </figure>

  <p class="aside support">If you have any difficulty anywhere in this tutorial, please <a href="https://github.com/lexogram/openbook/issues/new">tell us about it</a>, and we'll do our best to deal with it for you. Your questions and suggestions can help us make this tutorial better.

  <footer>
    <ul class="nav">
    <li>
    <a href="#waiver">
    <img src="../img/arrow.png" alt="next"/>
    </a>
    </li>
    </ul>
  </footer>
</section>
</article>
</main>

<script src="../js/core.js"></script>
</body>
</html>
